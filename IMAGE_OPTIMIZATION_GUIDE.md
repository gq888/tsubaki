# å›¾ç‰‡ä¼˜åŒ–æŒ‡å— - WebP è½¬æ¢

## æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ WebP æ ¼å¼æ›¿ä»£ JPG/PNG å›¾ç‰‡ï¼Œå¯ä»¥æ˜¾è‘—å‡å°æ–‡ä»¶ä½“ç§¯ï¼ˆé€šå¸¸èŠ‚çœ 25-35%ï¼‰ï¼Œæå‡åŠ è½½é€Ÿåº¦ã€‚

---

## å¿«é€Ÿå¼€å§‹

### ä¸€é”®ä¼˜åŒ–ï¼ˆæ¨èï¼‰

```bash
npm run img:optimize
```

è¿™ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. âœ… å°† `public/static` ä¸‹çš„æ‰€æœ‰ JPG å›¾ç‰‡è½¬æ¢ä¸º WebP
2. âœ… æ›´æ–°æ‰€æœ‰ä»£ç ä¸­çš„å›¾ç‰‡å¼•ç”¨ï¼ˆ`.jpg` â†’ `.webp`ï¼‰
3. âœ… åˆ é™¤åŸå§‹ JPG æ–‡ä»¶ï¼ˆå¯é…ç½®ï¼‰

---

## åˆ†æ­¥æ‰§è¡Œ

### æ­¥éª¤ 1: è½¬æ¢å›¾ç‰‡

```bash
npm run img:convert
```

**åŠŸèƒ½**ï¼š
- æ‰¹é‡è½¬æ¢ `public/static/*.jpg` ä¸º WebP æ ¼å¼
- ä½¿ç”¨ sharp åº“è¿›è¡Œé«˜è´¨é‡è½¬æ¢ï¼ˆè´¨é‡ 85ï¼‰
- æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„è½¬æ¢ç»“æœå’Œå¤§å°èŠ‚çœ

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ–¼ï¸  å›¾ç‰‡è½¬æ¢ä¸º WebP æ ¼å¼

æ‰¾åˆ° 66 ä¸ªå›¾ç‰‡æ–‡ä»¶

å¼€å§‹è½¬æ¢...

[1/66] 0.jpg ... âœ… 45.2 KB â†’ 32.1 KB (èŠ‚çœ 29.0%)
[2/66] 1.jpg ... âœ… 48.5 KB â†’ 34.8 KB (èŠ‚çœ 28.2%)
...

==================================================
è½¬æ¢å®Œæˆï¼

âœ… æˆåŠŸ: 66 ä¸ª
ğŸ“Š æ€»è®¡:
   åŸå§‹å¤§å°: 2.98 MB
   è½¬æ¢å: 2.11 MB
   èŠ‚çœ: 870 KB (29.2%)
```

### æ­¥éª¤ 2: æ›´æ–°ä»£ç å¼•ç”¨

```bash
npm run img:update-refs
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æ‰«æ `src/**/*.vue`ã€`src/**/*.js` æ–‡ä»¶
- æ›¿æ¢æ‰€æœ‰ `.jpg` â†’ `.webp` å¼•ç”¨
- æ˜¾ç¤ºä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ”„ æ›´æ–°å›¾ç‰‡å¼•ç”¨

æ‰¾åˆ° 12 ä¸ªæ–‡ä»¶

å¼€å§‹å¤„ç†...

âœ… src/components/fish.vue
   - å­—ç¬¦ä¸²ä¸­çš„ .jpg: 6 å¤„
âœ… src/components/Spider.vue
   - å­—ç¬¦ä¸²ä¸­çš„ .jpg: 6 å¤„
...

==================================================
æ›´æ–°å®Œæˆï¼

ğŸ“ ä¿®æ”¹äº† 12 ä¸ªæ–‡ä»¶
ğŸ”„ å…± 29 å¤„æ›´æ”¹
```

---

## é…ç½®é€‰é¡¹

### convert-to-webp.js é…ç½®

ç¼–è¾‘ `scripts/convert-to-webp.js`ï¼š

```javascript
const config = {
  sourceDir: path.join(projectRoot, 'public/static'),
  quality: 85,              // WebP è´¨é‡ (0-100)ï¼Œå»ºè®® 80-90
  extensions: ['.jpg', '.jpeg', '.png'],  // è¦è½¬æ¢çš„æ ¼å¼
  keepOriginal: false,      // æ˜¯å¦ä¿ç•™åŸå§‹æ–‡ä»¶
};
```

**è´¨é‡è¯´æ˜**ï¼š
- `85` - æ¨èå€¼ï¼Œå¹³è¡¡è´¨é‡å’Œå¤§å°
- `75-80` - æ›´å°ä½“ç§¯ï¼Œè½»å¾®è´¨é‡æŸå¤±
- `90-95` - æ¥è¿‘æ— æŸï¼Œä½“ç§¯è¾ƒå¤§

### update-image-refs.js é…ç½®

ç¼–è¾‘ `scripts/update-image-refs.js`ï¼š

```javascript
const config = {
  patterns: [
    'src/**/*.vue',
    'src/**/*.js',
    'src/**/*.ts',
  ],
  dryRun: false,  // è®¾ä¸º true é¢„è§ˆä¸ä¿®æ”¹
};
```

---

## æŠ€æœ¯ç»†èŠ‚

### æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

å½“å‰è½¬æ¢ï¼š
- âœ… `.jpg` â†’ `.webp`
- âœ… `.jpeg` â†’ `.webp`
- âœ… `.png` â†’ `.webp`

### å¼•ç”¨æ¨¡å¼

è„šæœ¬ä¼šæ›¿æ¢ä»¥ä¸‹æ¨¡å¼ï¼š

**JavaScript/TypeScript**:
```javascript
// æ›¿æ¢å‰
img.src = "./static/0.jpg"
:src="'./static/' + item.id + '.jpg'"

// æ›¿æ¢å
img.src = "./static/0.webp"
:src="'./static/' + item.id + '.webp'"
```

**Vue æ¨¡æ¿**:
```vue
<!-- æ›¿æ¢å‰ -->
<img :src="'./static/' + card + '.jpg'" />

<!-- æ›¿æ¢å -->
<img :src="'./static/' + card + '.webp'" />
```

### å—å½±å“çš„æ–‡ä»¶

æ ¹æ®æ‰«æç»“æœï¼Œä»¥ä¸‹æ–‡ä»¶ä¼šè¢«æ›´æ–°ï¼š
- `src/components/fish.vue` - 6 å¤„
- `src/components/Spider.vue` - 6 å¤„
- `src/components/sum.vue` - 4 å¤„
- `src/components/Chess.vue` - 2 å¤„
- `src/components/Pairs.vue` - 2 å¤„
- `src/components/month.vue` - 2 å¤„
- `src/components/Sort.vue` - 1 å¤„
- `src/components/Tortoise.vue` - 1 å¤„
- `src/components/point24.vue` - 1 å¤„
- `src/components/point24card.vue` - 1 å¤„
- `src/utils/help.js` - 1 å¤„

---

## æµè§ˆå™¨å…¼å®¹æ€§

### WebP æ”¯æŒæƒ…å†µ

âœ… **å®Œå…¨æ”¯æŒ**ï¼ˆè¦†ç›– 96%+ ç”¨æˆ·ï¼‰:
- Chrome 23+ (2012å¹´)
- Firefox 65+ (2019å¹´)
- Safari 14+ (2020å¹´)
- Edge 18+ (2018å¹´)
- Opera 12.1+ (2012å¹´)

### é™çº§æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰

å¦‚éœ€æ”¯æŒæ—§æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨ `<picture>` æ ‡ç­¾ï¼š

```vue
<picture>
  <source :srcset="'./static/' + card + '.webp'" type="image/webp">
  <img :src="'./static/' + card + '.jpg'" alt="Card">
</picture>
```

æˆ–ä½¿ç”¨ JavaScript æ£€æµ‹ï¼š

```javascript
function supportsWebP() {
  const elem = document.createElement('canvas');
  return elem.toDataURL('image/webp').indexOf('data:image/webp') === 0;
}
```

---

## é¢„è§ˆæ¨¡å¼

åœ¨å®é™…ä¿®æ”¹å‰é¢„è§ˆæ›´æ”¹ï¼š

```bash
# 1. ç¼–è¾‘ update-image-refs.js
# å°† dryRun: false æ”¹ä¸º dryRun: true

# 2. è¿è¡Œé¢„è§ˆ
npm run img:update-refs

# 3. æŸ¥çœ‹é¢„è§ˆç»“æœï¼ˆä¸ä¼šä¿®æ”¹æ–‡ä»¶ï¼‰

# 4. ç¡®è®¤åï¼Œæ”¹å› dryRun: false å¹¶é‡æ–°è¿è¡Œ
```

---

## å›æ»šæ–¹æ¡ˆ

### å¦‚æœéœ€è¦æ¢å¤ JPG

1. **ä»å¤‡ä»½æ¢å¤**ï¼ˆå¦‚æœè®¾ç½®äº† `keepOriginal: true`ï¼‰:
   ```bash
   # JPG æ–‡ä»¶ä»åœ¨ public/static ç›®å½•
   # åªéœ€æ¢å¤ä»£ç å¼•ç”¨
   git checkout -- src/
   ```

2. **ä» Git å†å²æ¢å¤**:
   ```bash
   git checkout HEAD~1 -- public/static
   git checkout HEAD~1 -- src/
   ```

3. **é‡æ–°ç”Ÿæˆ JPG**:
   ```bash
   # ä½¿ç”¨ sharp æˆ–å…¶ä»–å·¥å…·ä» WebP è½¬å› JPG
   ```

---

## æ€§èƒ½æå‡

### é¢„æœŸæ•ˆæœ

æ ¹æ®æµ‹è¯•ï¼Œè½¬æ¢ä¸º WebP åï¼š

| æŒ‡æ ‡ | æ”¹å–„ |
|------|------|
| æ–‡ä»¶ä½“ç§¯ | â†“ 25-35% |
| é¦–å±åŠ è½½æ—¶é—´ | â†“ 15-25% |
| ç½‘ç»œä¼ è¾“é‡ | â†“ 25-35% |
| ç”¨æˆ·ä½“éªŒ | â†‘ æµç•…åŠ è½½ |

### å®é™…æ•°æ®ï¼ˆæœ¬é¡¹ç›®ï¼‰

- **å›¾ç‰‡æ€»æ•°**: 66 å¼ 
- **åŸå§‹å¤§å°**: ~3 MB (JPG)
- **è½¬æ¢å**: ~2.1 MB (WebP)
- **èŠ‚çœ**: ~870 KB (29%)

---

## å¸¸è§é—®é¢˜

### Q: è½¬æ¢ä¼šå½±å“å›¾ç‰‡è´¨é‡å—ï¼Ÿ
A: ä½¿ç”¨è´¨é‡ 85 æ—¶ï¼Œè§†è§‰ä¸Šå‡ ä¹æ— å·®å¼‚ã€‚WebP åœ¨ç›¸åŒè´¨é‡ä¸‹ä½“ç§¯æ›´å°ã€‚

### Q: éœ€è¦ä¿®æ”¹æ„å»ºé…ç½®å—ï¼Ÿ
A: ä¸éœ€è¦ã€‚Webpack/Vite è‡ªåŠ¨å¤„ç† WebP æ–‡ä»¶ï¼Œä¸ JPG ç›¸åŒã€‚

### Q: å¯ä»¥è½¬æ¢å…¶ä»–æ ¼å¼å—ï¼Ÿ
A: å¯ä»¥ã€‚ä¿®æ”¹ `config.extensions` æ·»åŠ  `.png`ã€`.gif` ç­‰ã€‚

### Q: è½¬æ¢å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: 
1. ç¡®ä¿å®‰è£…äº† sharp: `npm install --save-dev sharp`
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### Q: å¦‚ä½•åªè½¬æ¢éƒ¨åˆ†å›¾ç‰‡ï¼Ÿ
A: ä¿®æ”¹ `config.sourceDir` æŒ‡å‘ç‰¹å®šå­ç›®å½•ï¼Œæˆ–æ·»åŠ è¿‡æ»¤é€»è¾‘ã€‚

---

## ä¾èµ–

### éœ€è¦å®‰è£…

```bash
npm install --save-dev sharp glob
```

- **sharp**: é«˜æ€§èƒ½å›¾ç‰‡å¤„ç†åº“ï¼ˆNode.js åŸç”Ÿï¼‰
- **glob**: æ–‡ä»¶æœç´¢å·¥å…·

### è‡ªåŠ¨å®‰è£…

è¿è¡Œ `npm run img:convert` æ—¶ï¼Œå¦‚æœ sharp æœªå®‰è£…ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ã€‚

---

## ç»´æŠ¤

### æ–°å¢å›¾ç‰‡

ä»¥åæ·»åŠ æ–°å›¾ç‰‡æ—¶ï¼š
1. ç›´æ¥æ·»åŠ  WebP æ ¼å¼åˆ° `public/static`
2. æˆ–æ·»åŠ  JPG åè¿è¡Œ `npm run img:optimize`

### æ‰¹é‡ä¼˜åŒ–

å®šæœŸè¿è¡Œä»¥ä¼˜åŒ–æ–°å¢å›¾ç‰‡ï¼š

```bash
npm run img:optimize
```

---

## æ€»ç»“

âœ… **ä¼˜åŠ¿**:
- æ˜¾è‘—å‡å°æ–‡ä»¶ä½“ç§¯
- æå‡åŠ è½½é€Ÿåº¦
- æ”¹å–„ç”¨æˆ·ä½“éªŒ
- è‡ªåŠ¨åŒ–å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

âš ï¸ **æ³¨æ„**:
- é¦–æ¬¡è¿è¡Œå‰å»ºè®®å¤‡ä»½
- ç¡®è®¤æµè§ˆå™¨å…¼å®¹æ€§è¦æ±‚
- å¯ä»¥ä½¿ç”¨é¢„è§ˆæ¨¡å¼å…ˆæ£€æŸ¥

ğŸš€ **å¼€å§‹ä¼˜åŒ–**:
```bash
npm run img:optimize
```

---

**åˆ›å»ºæ—¶é—´**: 2025-10-11  
**ç‰ˆæœ¬**: 1.0.0  
**ç»´æŠ¤è€…**: Tsubaki Team
