# 游戏设置功能说明

## 功能概述

在 GameLayout 组件的右上角添加了一个设置按钮（⚙️），点击后可以打开设置弹窗，用户可以调整游戏的自动模式延迟速度。

## 主要特性

### 1. 设置按钮
- **位置**：右上角固定位置
- **样式**：圆形绿色按钮，悬停时旋转 90 度
- **图标**：⚙️ 齿轮图标

### 2. 设置弹窗
- **延迟速度滑动条**：
  - 从"快"到"慢"调节
  - 范围：100ms - 2000ms
  - 通过渐变色滑动条调节（绿色→橙色→红色）
  - 不显示具体数值，以更直观的方式调节

- **应用范围选择**：
  - ☐ 应用到全部游戏：设置会影响所有游戏
  - 不勾选时：仅影响当前游戏

### 3. 设置持久化
- 使用 localStorage 存储设置
- 游戏特定设置：`game-delay-{gameName}`
- 全局设置：`game-global-delay`
- 刷新页面后设置依然保留

### 4. 设置加载优先级
1. 优先加载游戏特定设置
2. 其次加载全局设置
3. 最后使用默认值（500ms）

## 实现细节

### 新增文件

1. **GameSettings.vue**
   - 设置弹窗组件
   - 包含滑动条和单选框
   - 处理设置的保存和加载

2. **gameSettingsManager.js**
   - 设置管理器单例
   - 统一管理设置的读取、保存和事件通知
   - 支持监听器模式，设置变化时自动通知所有订阅者

### 修改文件

1. **GameLayout.vue**
   - 添加设置按钮（右上角）
   - 集成 GameSettings 组件
   - 添加设置按钮样式

2. **GameStateManager.js**
   - 新增 `setAutoStepDelay(delay)` 方法
   - 新增 `getAutoStepDelay()` 方法

3. **gameComponentFactory.js**
   - 在组件创建时自动加载延迟设置
   - 自动订阅设置变化事件
   - 组件销毁时清理监听器

## 使用方式

### 对于用户
1. 点击右上角的 ⚙️ 按钮
2. 拖动滑动条调整延迟速度（左边快，右边慢）
3. 选择是否应用到全部游戏
4. 点击"保存"按钮

### 对于开发者
所有使用 `GameLayoutPresets` 或 `createEnhancedGameComponent` 创建的游戏组件会自动支持设置功能，无需额外配置。

## 技术架构

```
┌─────────────────┐
│  GameLayout.vue │
│   (设置按钮)     │
└────────┬────────┘
         │
         ▼
┌─────────────────────┐
│ GameSettings.vue    │
│   (设置弹窗)        │
└────────┬────────────┘
         │
         ▼
┌──────────────────────────┐
│ gameSettingsManager.js   │
│   (设置管理器)           │
└────────┬─────────────────┘
         │
         ▼
┌──────────────────────────┐
│ gameComponentFactory.js  │
│   (自动加载和监听)       │
└────────┬─────────────────┘
         │
         ▼
┌──────────────────────────┐
│ GameStateManager.js      │
│   (更新延迟时间)         │
└──────────────────────────┘
```

## 数据流

1. 用户调整设置 → GameSettings.vue
2. 保存设置 → gameSettingsManager.saveDelay()
3. 存储到 localStorage
4. 触发监听器 → 通知所有订阅的游戏组件
5. 游戏组件 → GameStateManager.setAutoStepDelay()
6. 自动模式使用新的延迟时间

## 注意事项

- 设置变化会立即生效，无需刷新页面
- "应用到全部游戏"会清除所有游戏特定的设置
- 如果既没有游戏特定设置也没有全局设置，使用默认值 500ms
